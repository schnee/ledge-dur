---
title: "Legislative Endurance"
author: "Brent Schneeman"
date: "March 25, 2016"
output: html_document
---

```{r setup, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(yaml)
library(dplyr)
library(lubridate)
library(ggplot2)
library(ggalt)
library(ggthemes)

ledge <- yaml.load_file("./data/legislators-historical.yaml")

# want to create a dataframe with id, name, term type, term start, term end, and party out of the ledge object

extractElements <- function(e){
  id <- e$id$govtrack
  firstName <- e$name$first
  lastName <- e$name$last
  gender<-e$bio$gender

  numTerms = length(e$terms)
  firstTerm <- e$terms[[1]]
  lastTerm <- e$terms[[numTerms]]
  termStart <- firstTerm$start
  termEnd <- lastTerm$end
  party <- firstTerm$party
  if(is.null(party)) {
    party<-"Unknown"
  }
  type <- firstTerm$type
  
  data.frame(id=id, firstName=firstName, lastName=lastName, gender=gender, 
             numTerms = numTerms,
             start=termStart, 
             end=termEnd, 
             party=party, 
             type=type, 
             stringsAsFactors = F)
}

splinePoints <- function(theIndex, df){
  
  e <- df[df$id==theIndex,]
  
  # the number of terms is how high the spline should reach
  peak <- e$numTerms
  
  # this output dataframe defines the shape of the spline. Lots of 
  # customization here.
  data.frame(x=quantile(c(e$start, e$end), probs=c(0,.15,.85,1)), 
             y=c(0, peak*.85, peak*.85, 0),
             splineIndex = e$id,
             party=e$party)
}


temp = lapply(ledge, extractElements)
ledge_df = bind_rows(temp)

ledge_df$start= ymd(ledge_df$start)
ledge_df$end <- ymd(ledge_df$end)
ledge_df$gender <- as.factor(ledge_df$gender)
ledge_df$party <- as.factor(ledge_df$party)
ledge_df$type <- as.factor(ledge_df$type)
ledge_df$dur <- ledge_df$end - ledge_df$start

ledge_df[ledge_df$party=="Republican",]$numTerms <- ledge_df[ledge_df$party=="Republican",]$numTerms * -1

```
```{r Senate, echo=FALSE}

body <- ledge_df %>% 
  filter(dur < 22000) %>%
  filter(type=="sen") %>% 
  filter(party %in% c("Democrat", "Republican"))%>% 
  arrange(start, end) 

temp <- lapply(X=body$id, FUN=splinePoints, body)
theSplines <- bind_rows(temp)

ggplot(theSplines, aes(x, y, group=splineIndex, colour=party)) + 
  geom_xspline(spline_shape = -0.5, size=0.2) +
  scale_color_manual("US Senate", values=c("blue", "red")) +
  theme_few() + theme(axis.text.y = element_blank(),
                      axis.title.y = element_blank(),
                      axis.ticks.y = element_blank(),
                      panel.border = element_blank()) +
  xlab("Year")
```

## The Decline of American Politics

The Founding Fathers created the United States with the concept of citizen servants in mind. Men (originally, and land-owners at that) would represent constituents for a time and then return to their lives. Fresh-off the American Revolution, and having land to tend, this seemed like a good idea: who would want to spend time governing instead of working the land and being a member of the community where you built your life?

After being elected to two terms of the Presidency, George Washington decided to not run again, not wanting to create a democratic monarchy. Soon, the  government codified Presidential Term Limits in the US Constitution. Those term limits never trickled down to the Senate or the House; over time, legislators have spent more and more time legislating at the expense of being a member of their "home" communities.

```{r echo=FALSE}
ledge_df[ledge_df$party=="Republican",]$numTerms <- ledge_df[ledge_df$party=="Republican",]$numTerms * -1

body <- ledge_df %>% 
  filter(type=="sen") %>% 
  arrange(start, end) 

temp <- lapply(X=body$id, FUN=splinePoints, body)
theSplines <- bind_rows(temp)

ggplot(theSplines, aes(x, y, group=splineIndex)) + 
  geom_xspline(spline_shape = -0.5, size=0.2, colour="black") +
  theme_few() + theme(axis.text.y = element_blank(),
                      axis.title.y = element_blank(),
                      axis.ticks.y = element_blank(),
                      panel.border = element_blank()) +
  xlab("Year")

```

This plot shows the service arcs of every Senator to have *finished* serving (that is, currently sitting Senators are not shown). The heights of the arcs are related to the number of terms served the the horizontal axis progresses by year to the right. The arcs tend to get higher over time, which indicates that Senators are serving longer. The horizontal striations - the *levels* - exactly correspond to the number of terms served: one term, two terms, etc.

```{r echo=FALSE}
bks = seq(trunc(min(year(body$end)) / 10) * 10, trunc(max(year(body$end)) / 10) * 10 + 10, 10)
body$decade = bks[cut(year(body$end), breaks=bks, labels=FALSE)]

decades <- body %>%
  group_by(decade) %>% 
  summarize(aveDur = mean(as.numeric(dur, units="days")/365),
            aveTerms = mean(numTerms)) 

ggplot(decades, aes(x=decade, y=aveTerms, colour=decade)) + 
  geom_point(colour="black") + geom_smooth(method="lm", se=F, linetype="dashed", size=0.5) +
  theme_few() + ylab("Average Number of Terms") +
  xlab("Decade in Which Service Expired") +
  theme(panel.border = element_blank()) 

```

The average of the number of terms for every Senator who finished servicing in a partcular decade clearly shows an up-and-to-the-right increase: the number of terms each Senator is serving is increasing.

```{r echo=FALSE, message=FALSE}
belows = c("Republican", "Jackson", "Unknown", "Adams", "American", "Populist")
ledge_df[ledge_df$party %in% belows,]$numTerms <- ledge_df[ledge_df$party %in% belows,]$numTerms * -1

body <- ledge_df %>% 
  filter(dur < 22000) %>%
  filter(type=="sen") %>% 
  arrange(start, end) 

temp <- lapply(X=body$id, FUN=splinePoints, body)
theSplines <- bind_rows(temp)

ggplot(theSplines, aes(x, y, group=splineIndex, colour=party)) + 
  geom_xspline(spline_shape = -0.5, size=0.2) +
  theme_few() + theme(axis.text.y = element_blank(),
                      axis.title.y = element_blank(),
                      axis.ticks.y = element_blank(),
                      panel.border = element_blank()) +
  xlab("Year") + labs(colour="Party\nAffiliation")
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
